@page "/callback"

@using global::Blazor.Fluxor
@using StoryBlog.Web.Blazor.Client.Services
@using StoryBlog.Web.Blazor.Client.Store.Actions

@inject IIdentityApiClient Api
@inject IDispatcher Dispatcher
@inject NavigationManager NavigationManager

@functions
{
    
    protected override async Task OnInitializedAsync()
    {
        try
        {
            var principal = await Api.SigninCallbackAsync();

            Dispatcher.Dispatch(new SigninRequestSuccessAction(principal));
            NavigationManager.NavigateTo("/");
        }
        //catch (HttpRequestException exception)
        catch (Exception exception)
        {
            Dispatcher.Dispatch(new SigninRequestCallbackFailedAction(exception.Message));
        }
    }

}